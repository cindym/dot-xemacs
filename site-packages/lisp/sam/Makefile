.SUFFIXES: .el .elc

EMACS = xemacs

.el.elc:
	$(EMACS) -batch -q $(HELPER) -f batch-byte-compile $<

ELCS =  cpuinfo.elc\
	dired-extras.elc\
	filter.elc\
	git-diff.elc \
	gpl.elc \
	h2t.elc\
	http.elc\
	ksh-mode.elc \
	lxr.elc\
	mpg.elc\
	my-calc.elc\
	my-compile.elc\
	my-sparse.elc \
	slashdot.elc\
	smerge.elc\
	svn.elc\
	trim.elc\
	vc-ediff.elc\
	xcomp.elc \

ifneq ($(findstring xemacs,$(EMACS)),)
EXTRA = backup.elc auto-autoloads.elc
VERSION = $(shell $(EMACS) -V -vanilla | cut -d' ' -f2)
else
HELPER := --eval "(setq load-path (append load-path '(\"~/.emacs.d/esp\" \".\")))"
EXTRA = sam-loaddefs.el
endif

all:	$(ELCS) $(EXTRA)

auto-autoloads.el: $(ELCS)
	rm -f auto-autoloads.el
	@echo "XEmacs $(VERSION)"
ifeq ($(EMACS),sxemacs)
	$(EMACS) -batch -f batch-create-autoloads .
else
  ifeq ($(VERSION),21.4)
	$(EMACS) -batch -q -no-site-file -l autoload \
		-f batch-update-directory .
  else
	$(EMACS) -batch -q -no-site-file -l autoload \
		-f batch-update-directory-autoloads sam .
  endif
endif

sam-loaddefs.el:
	$(EMACS) -batch -q -l batch-helper.el -l build-loaddefs.el -f build-loaddefs

tags:
	etags *.el

clean:
	rm -f *.elc auto-autoloads.el TAGS *~
